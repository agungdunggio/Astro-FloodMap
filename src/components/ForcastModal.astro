<!-- ---
export interface Props {
  aggregatedData: any;
}
const { aggregatedData } = Astro.props;
---

<div id="forecastModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h4>Prakiraan Cuaca Agregat (Kota Gorontalo)</h4>
      <button id="closeModalBtn" class="close-btn">×</button>
    </div>
    <div id="bmkgAggregatedForecastContent" class="modal-body">
      {aggregatedData && Object.keys(aggregatedData).length > 0 ? (
        Object.entries(aggregatedData).map(([kecamatanKey, dataKecamatan]) => (
          <div class="kecamatan-forecast-block">
            <h5>{dataKecamatan.namaResmi}</h5>
            {dataKecamatan.forecasts && dataKecamatan.forecasts.length > 0 ? (
              <ul>
                {dataKecamatan.forecasts.slice(0, 17).map(item => {
                  // Konversi localDateTime ke string untuk rendering aman
                  const date = new Date(item.localDateTime);
                  const isValidDate = !isNaN(date.getTime());
                  const localDate = isValidDate
                    ? date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' })
                    : 'Tanggal tidak valid';
                  const localTime = isValidDate
                    ? date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })
                    : 'Waktu tidak valid';
                  return (
                    <li>
                      <strong>{localDate}, {localTime} WITA</strong><br/>
                      <img
                        src={item.iconUrl}
                        alt={item.weatherDesc || 'ikon cuaca'}
                        style="width:22px; height:22px; vertical-align:middle; margin-right:3px; background-color: #f0f0f0; border-radius: 4px;"
                      />
                      <span>{item.weatherDesc || 'N/A'}</span><br/>
                      <span>
                        Suhu: {item.temperature != null ? item.temperature + '°C' : 'N/A'} | 
                        Hujan: {item.totalPrecipitation != null ? item.totalPrecipitation + ' mm' : 'N/A'}
                      </span>
                    </li>
                  );
                })}
              </ul>
            ) : (
              <p><small>Tidak ada data prakiraan untuk kecamatan ini.</small></p>
            )}
          </div>
        ))
      ) : (
        <div style="text-align:center; padding:20px;">Tidak ada data prakiraan untuk ditampilkan.</div>
      )}
    </div>
  </div>
</div>

<style>
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  .modal-content {
    background-color: white;
    padding: 20px;
    border-radius: 5px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
  }
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .close-btn {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
  }
  .kecamatan-forecast-block {
    margin-bottom: 20px;
  }
  ul {
    list-style: none;
    padding: 0;
  }
  li {
    margin-bottom: 10px;
  }
</style> -->