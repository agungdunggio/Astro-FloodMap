---
import BaseLayout from '../layouts/BaseLayout.astro';
import ForecastModal from '../components/forecast/ForecastModal.vue';
// import { getAggregatedForecastForKotaGorontalo } from '../js/fetch/bmkgAggregatedForecast.js';

// // Ambil data di server-side dengan error handling
// let aggregatedData = null;
// try {
//   aggregatedData = await getAggregatedForecastForKotaGorontalo();
// } catch (error) {
//   console.error('Gagal mengambil data BMKG:', error);
// }
---
<BaseLayout title="Peta Dasar Gorontalo & Prakiraan Cuaca Agregat - Simulasi Banjir">
  <main>  
    {/* Kontainer untuk Cesium Viewer */}
    <div id="cesiumContainer"></div>
    
    {/* Tombol untuk membuka modal */}
    <button id="openForecastBtn" class="forecast-btn">
      <span class="btn-icon">üå§Ô∏è</span>
      <span class="btn-text">Prakiraan Cuaca</span>
      <div id="loadingIndicator" class="loading-indicator hidden">
        <div class="spinner"></div>
      </div>
    </button>

    {/* Modal untuk menampilkan data BMKG */}
    <!-- <div id="forecastModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h4>Prakiraan Cuaca Agregat (Kota Gorontalo)</h4>
          <button id="closeModalBtn" class="close-btn">&times;</button>
        </div>
        <div id="bmkgAggregatedForecastContent" class="modal-body">
          Memuat dan mengagregasi prakiraan...
        </div>
      </div>
    </div> -->

    <ForecastModal client:load />
    
    <script>
      import { initializeBaseMap } from "../js/mainCesium.js";
      import { initializePage } from '../js/utils/pageUtils.js';
      
      // Initialize dengan error handling yang lebih baik
      // Note: initializePetaDasarPageUI sudah dipanggil di dalam initializeBaseMap
      initializePage(initializeBaseMap, 'Peta Dasar Gorontalo');
    </script>
    
    <style>@import '../style/peta-dasar-style.css';</style>
  </main>
</BaseLayout>
